<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üåæ Crop Disease Classifier</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0fdf4;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    h1 {
      color: #157347;
    }
    form {
      margin-top: 20px;
    }
    input[type="file"] {
      margin: 10px 0;
    }
    button {
      background-color: #157347;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 5px;
    }
    button:hover {
      background-color: #145c3c;
    }
    img {
      max-width: 300px;
      margin: 10px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    .result-box {
      background: #e9fbe9;
      padding: 20px;
      border-radius: 10px;
      border: 2px solid #c1e1c1;
      max-width: 600px;
      margin: 20px auto;
      text-align: left;
    }
  </style>
</head>
<body>
  <h1>üåæ Crop Disease Classifier</h1>

  <form id="uploadForm">
    <input type="file" id="image" accept="image/*" required />
    <br />
    <button type="submit">Classify Image</button>
  </form>

  <img id="preview" style="display: none;" />
  <div id="result" class="result-box"></div>

  <script>
    document.getElementById("image").addEventListener("change", function (e) {
      const file = e.target.files[0];
      const preview = document.getElementById("preview");
      if (file) {
        preview.src = URL.createObjectURL(file);
        preview.style.display = "block";
      } else {
        preview.style.display = "none";
      }
    });

    document.getElementById("uploadForm").addEventListener("submit", async function (e) {
      e.preventDefault();
      const formData = new FormData();
      const fileInput = document.getElementById("image");
      const file = fileInput.files[0];
      formData.append("image", file);

      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = `
        <p>üîç Uploading and analyzing image...</p>
        <p>ü§ñ Asking AI for treatment suggestion...</p>
      `;

      try {
        const res = await fetch("/classify", {
          method: "POST",
          body: formData,
        });
        const data = await res.json();

        const prediction = data[0];
        const label = prediction.label;
        const score = (prediction.score * 100).toFixed(2) + "%";

        const treatmentRes = await fetch("/treatment", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ diseaseName: label }),
        });
        const treatmentData = await treatmentRes.json();
        const treatment = treatmentData.treatment || "No treatment found.";

        const previewURL = URL.createObjectURL(file);

        resultDiv.innerHTML = `
          <img src="${previewURL}" />
          <p>‚úÖ <strong>${label}</strong> (${score})</p>
          <p>üß™ <strong>Treatment Suggestion:</strong><br>${treatment}</p>
        `;
      } catch (err) {
        resultDiv.innerHTML = `‚ùå Error: ${err.message}`;
      }
    });
  </script>
</body>
</html>
